:doctype: article
:lang: ja
:toc: left
:toc-levels: 5
:toc-title: 目次
:sectnums:
:sectnum-levels: 5
:icons: font
:imagesdir: Images
:docdir: Docs
:xrefstyle: short
:abstract-caption: 概要
:figure-caption: 図
:table-caption: 表
:listing-caption: リスト
:appendix-caption: 付録
:example-caption: 例
:source-highlighter: highlightjs
:stem: latexmath

= k8sLearning

== k8sのリソース

=== Workoads API

.コンテナの実行に関するリソース
[cols="4,~,~",options="header"]
|===
|種類|概要|備考
| Pod a| 
* 1つ以上のコンテナからなるリソース
* 同じPodに含まれるコンテナ同氏はIPアドレスを共有し、localhostで通信可能|
|  ReplicaSet  | 指定した数のPodを維持し続けるリソース（セルフヒーリング）  |
| Deployment | ReplicaSetを管理し、ローリングアップデートやロールバックを実現するリソース  | ローリングアップデートはシステムを停止させずに徐々にソフトウェアを入替・更新する方式
| DaemonSet a|
* ReplicaSetの特殊形で、各ノードにPodを1つずつ配置するリソース
* 全ノードで必ず動作させたいプロセスに利用する  |
| StatefulSet a| 
* ReplicaSetの特殊計で、DBなどステートフルなワークロードに対応するためのリソース
* PersistentVolumeClaimを利用して永続化領域を確保し、Podにアタッチする |
| Job a|
* コンテナを利用して一度限りの処理を実行させるリソース
* ReplicaSetと異なり、Podの停止 = 正常終了となる用途（バッチ処理など）向き a|
* タスク型は（N並列で）Podの正常終了がK回になるまで実行
* ワークキュー型はN並列で、1つでも正常終了するまで実行
| CronJob | スケジュールされた時間にJobを実行するリソース |
|===

.各リソースの親子関係
[cols="10,10,10",options="header",valign="middle",halign="center"]
|===
|下位リソース| <- | 上位リソース
.4+^.^|`Pod` |`ReplicaSet` |`Deployment`
|`DaemonSet` |-
|`StatefulSet` |-
|`Job` |`CronJob` |-
|===
上位リソースが下位リソースを段階的に管理する。

=== Service API

コンテナを外部に公開するようなエンドポイントを提供するリソースで、以下の2種に大別される

[cols="4,~,~",options="header"]
|===
|種別|概要|備考
|Service|L4LBを提供するリソース .2+.^a| 
L4LB::
* セッション単位で負荷分散をする
* やることが単純なため処理が早い
L7LB::
* リクエスト単位で負荷分散をする
* リクエスト内容に基づいた高度な負荷分散ができる

https://qiita.com/masaozi3/items/838060d7339aef01bc2e[ロードバランサーにも種類がある話 - Qiita]
|Ingress|L7LBを提供するリソース
|===

==== k8sのネットワーク

コンテナ間通信::
* 同一Pod内のコンテナ間の通信はlocalhost宛てに通信
* Podをまたいだコンテナ間の通信はPodのIPアドレス宛てに通信

K8sクラスタの内部ネットワーク::
* ノードごとに異なるネットワークセグメントを構築し、ノード間で通信化

.Serviceリソースに属するType
[cols="4,~,~",options="header"]
|===
|種類|概要|備考

|===

=== Config/Storage API

=== Cluster API

=== Metadata API